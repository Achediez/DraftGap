<div class="dashboard-container">
  <div *ngIf="!user || !user.email" class="dashboard-loading">
    <div class="loading-spinner"></div>
    <h2>Inicializando DraftGap...</h2>
    <p>Cargando perfil competitivo y datos recientes.</p>
  </div>

  <ng-container *ngIf="user && user.email">
    <header class="dashboard-topbar">
      <div class="brand-block">
        <img class="brand-logo" src="/content/morado.png" alt="DraftGap logo" />
        <h1>DraftGap</h1>
        <p>Rendimiento, decisiones y progreso competitivo en un solo panel.</p>
      </div>

      <div class="user-menu">
        <button class="user-menu-btn" aria-label="Opciones de usuario" (click)="toggleMenu()" [attr.aria-expanded]="menuOpen">
          <img class="user-menu-icon" [src]="user.iconUrl || 'https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/4419.png'" alt="icono usuario" />
        </button>
        <div class="user-menu-dropdown" *ngIf="menuOpen" tabindex="-1">
          <button class="user-menu-item" (click)="logout($event)">Cerrar sesión</button>
          <button *ngIf="isAdmin" class="user-menu-item" (click)="goToAdmin($event)">Gestión</button>
        </div>
      </div>
    </header>

    <div class="hero-panel">
      <div class="profile-header">
        <img class="profile-icon" [src]="user.iconUrl || 'https://ddragon.leagueoflegends.com/cdn/13.24.1/img/profileicon/4419.png'" alt="icono perfil" />
        <div class="profile-info">
          <h2>{{ user.riotId || '-' }}</h2>
          <div class="region" *ngIf="user.region">{{ user.region }}</div>
          <button class="refresh-data-btn" type="button" [disabled]="syncLoading" (click)="refreshProfileData()">
            {{ syncLoading ? 'Actualizando...' : 'Actualizar datos' }}
          </button>
          <p *ngIf="syncMessage" class="sync-feedback sync-feedback-ok">{{ syncMessage }}</p>
          <p *ngIf="syncError" class="sync-feedback sync-feedback-error">{{ syncError }}</p>
        </div>
      </div>

      <div class="summary-cards">
        <article class="summary-card" *ngFor="let card of summaryCards">
          <span class="summary-label">{{ card.label }}</span>
          <strong class="summary-value">{{ card.value }}</strong>
        </article>
      </div>
    </div>

    <nav class="dashboard-sections">
      <button [class.active]="activeSection === 'historial'" (click)="activeSection = 'historial'">Historial</button>
      <button [class.active]="activeSection === 'campeones'" (click)="activeSection = 'campeones'">Campeones</button>
      <button [class.active]="activeSection === 'ranked'" (click)="activeSection = 'ranked'">Ranked</button>
      <button [class.active]="activeSection === 'jugadores'" (click)="activeSection = 'jugadores'">Jugadores</button>
      <button [class.active]="activeSection === 'graficos'" (click)="activeSection = 'graficos'">Gráficos</button>
      <button [class.active]="activeSection === 'chatbot'" (click)="activeSection = 'chatbot'">Coach IA</button>
    </nav>

    <section *ngIf="activeSection === 'historial'" class="content-grid">
      <aside class="side-panel">
        <div class="panel-block">
          <h3>Snapshot ranked</h3>
          <p class="tier">{{ rankedOverview.tier }} · {{ rankedOverview.lp }} LP</p>
          <p>MMR estimado: {{ rankedOverview.mmr }}</p>
          <p>Ganancia/Pérdida: {{ rankedOverview.lpDelta }}</p>
        </div>

        <div class="panel-block">
          <h3>Top picks</h3>
          <ul>
            <li *ngFor="let pick of topPicks">{{ pick.champion }} · {{ pick.games }} partidas · {{ pick.winrate }}</li>
            <li *ngIf="topPicks.length === 0" class="empty-state">Sin picks disponibles. Sincroniza tu cuenta para ver tus campeones más jugados.</li>
          </ul>
        </div>

        <div class="panel-block">
          <h3>Amigos</h3>
          <ul>
            <li *ngFor="let friend of friends">{{ friend.name }} · {{ friend.lane }} · {{ friend.status }}</li>
            <li *ngIf="friends.length === 0" class="empty-state">Sin contactos registrados por ahora.</li>
          </ul>
        </div>

        <div class="panel-block">
          <h3>Rivales y aliados recientes</h3>
          <ul>
            <li *ngFor="let p of recentPlayers">{{ p.name }} · {{ p.lane }} · {{ p.result }}</li>
            <li *ngIf="recentPlayers.length === 0" class="empty-state">Aún no hay historial de jugadores recientes.</li>
          </ul>
        </div>
      </aside>

      <article class="main-panel">
        <h3>Historial de partidas</h3>
        <table>
          <thead>
            <tr>
              <th>Campeón</th>
              <th>Resultado</th>
              <th>KDA</th>
              <th>CS</th>
              <th>Modo</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let match of recentMatches">
              <td><img [src]="match.championImg" class="champion-img" alt="{{ match.champion }}" /> {{ match.champion }}</td>
              <td>{{ match.result }}</td>
              <td>{{ match.kda }}</td>
              <td>{{ match.cs }}</td>
              <td>{{ match.mode }}</td>
              <td>{{ match.date }}</td>
            </tr>
            <tr *ngIf="recentMatches.length === 0">
              <td colspan="6" class="empty-state">No hay partidas disponibles todavía. Ejecuta una sincronización para cargar el historial.</td>
            </tr>
          </tbody>
        </table>
      </article>
    </section>

    <section *ngIf="activeSection === 'campeones'" class="section-card">
      <h3>Campeones · Maestría y rendimiento real</h3>
      <table>
        <thead>
          <tr>
            <th>Campeón</th>
            <th>Maestría</th>
            <th>Puntos</th>
            <th>Winrate</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let champ of championMasteries">
            <td>{{ champ.champion }}</td>
            <td>{{ champ.mastery }}</td>
            <td>{{ champ.points }}</td>
            <td>{{ champ.winrate }}</td>
          </tr>
          <tr *ngIf="championMasteries.length === 0">
            <td colspan="4" class="empty-state">Sin estadísticas de campeones por ahora.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section *ngIf="activeSection === 'ranked'" class="section-card">
      <h3>Ranked · Elo, MMR y eficiencia de LP</h3>
      <div class="ranked-grid">
        <article>
          <span>Tier actual</span>
          <strong>{{ rankedOverview.tier }}</strong>
        </article>
        <article>
          <span>LP actual</span>
          <strong>{{ rankedOverview.lp }} LP</strong>
        </article>
        <article>
          <span>MMR estimado</span>
          <strong>{{ rankedOverview.mmr }}</strong>
        </article>
        <article>
          <span>Ganancia / Pérdida</span>
          <strong>{{ rankedOverview.lpDelta }}</strong>
        </article>
      </div>
    </section>

    <section *ngIf="activeSection === 'jugadores'" class="section-card">
      <h3>Jugadores · red competitiva</h3>
      <div class="players-section-grid">
        <article class="players-category">
          <h4>Amigos</h4>
          <ul class="players-list">
            <li *ngFor="let friend of friends">
              <strong>{{ friend.name }}</strong>
              <span>{{ friend.lane }}</span>
              <span>{{ friend.status }}</span>
            </li>
            <li *ngIf="friends.length === 0" class="empty-state">Aún no tienes amigos añadidos.</li>
          </ul>
        </article>

        <article class="players-category">
          <h4>Players recientes</h4>
          <ul class="players-list">
            <li *ngFor="let p of recentPlayers">
              <strong>{{ p.name }}</strong>
              <span>{{ p.lane }}</span>
              <span>{{ p.result }}</span>
            </li>
            <li *ngIf="recentPlayers.length === 0" class="empty-state">Sin actividad reciente de jugadores.</li>
          </ul>
        </article>
      </div>
    </section>

    <section *ngIf="activeSection === 'jugadores'" class="section-card friends-request-card">
      <h3>Amigos · enviar solicitud</h3>
      <form class="friend-request-form" (ngSubmit)="sendFriendRequest()">
        <input
          type="text"
          name="friendRiotId"
          [(ngModel)]="friendRequestRiotId"
          placeholder="Riot ID (ej: DraftGapPlayer#EUW)"
        />
        <button type="submit">Enviar solicitud</button>
      </form>

      <p *ngIf="friendRequestMessage" class="friend-request-message">{{ friendRequestMessage }}</p>
      <p *ngIf="friendRequestError" class="friend-request-error">{{ friendRequestError }}</p>

      <div *ngIf="sentFriendRequests.length > 0" class="sent-requests">
        <h4>Solicitudes enviadas</h4>
        <ul>
          <li *ngFor="let req of sentFriendRequests">{{ req.riotId }} · {{ req.status }}</li>
        </ul>
      </div>
    </section>

    <section *ngIf="activeSection === 'graficos'" class="section-card">
      <h3>Gráficos · lectura de rendimiento</h3>
      <div class="placeholder-grid">
        <article>Rendimiento por partida</article>
        <article>Winrate por campeón</article>
        <article>Distribución por modo</article>
      </div>
    </section>

    <section *ngIf="activeSection === 'chatbot'" class="section-card">
      <h3>Coach IA</h3>
      <p>Próximamente: asistente para revisión de partidas, planes de mejora y recomendaciones tácticas personalizadas.</p>
    </section>

    <div *ngIf="isAdmin" class="admin-section">
      <a class="admin-link" (click)="goToAdmin($event)" href="#">Abrir centro de administración</a>
    </div>
  </ng-container>
</div>
